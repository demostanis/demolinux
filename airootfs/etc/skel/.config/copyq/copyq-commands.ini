[Commands]
1\Command="const timeoutMilliseconds = 500;\n\nfunction reset(key, getFn, setFn) {\n    if (hasData()) {\n        settings(key, [data(mimeText), str(Date.now())]);\n        return false;\n    }\n\n    const last = settings(key);\n    if (!last) {\n        return false;\n    }\n\n    afterMilliseconds(timeoutMilliseconds, function() {\n      if (!str(getFn()) && last[1] == settings(key)[1]) {\n        serverLog('Reset from ' + key);\n        setFn(mimeText, last[0], mimeHidden, 1);\n      }\n    });\n    return true;\n}\n\nfunction resetClipboard() {\n    return reset('lastClipboard', clipboard, copy);\n}\n\nfunction resetSelection() {\n    return reset('lastSelection', selection, copySelection);\n}\n\nlet onClipboardChanged_ = onClipboardChanged;\nonClipboardChanged = function() {\n    onClipboardChanged_();\n    const wait = isClipboard() ? resetClipboard() : resetSelection();\n    if (wait) {\n        sleep(timeoutMilliseconds + 1000);\n    }\n}"
1\Icon=\xf246
1\IsScript=true
1\Name=Reset Empty Clipboard/Selection
